---
title: "Test10 overview"
author: "ULzii-Utas Narantsatsralt"
output:
  html_document:
    toc: no
    toc_float: yes
    theme: cerulean
  pdf_document:
    toc: no
  word_document:
    toc: no
---

---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(tidyr)
source("LoadData.R")
```

# General introduction

Test10 is for testing the IndividualRandomConnectivity class which uses a pre-existing connectivity matrix to construct a neural network. In this test, we check the equality between the pre-existing connectivity matrix and constructed connectivity matrix. We show the two connectivity matrices and, the raster plot of two populations.The pre-existing connectivity file needs to be in the INPUT folder. 

```{r,include=FALSE}
project_name  = 'Test10';#project_name is an identifier of the folder containing the simulation data. It is the title of the simulation 
                        #The date suffix does not need to be included
base_path    = getwd();

folders_ = list.files(path = base_path,pattern=paste("*",project_name,"_20*",sep=""));
folder_name = paste(base_path,folders_[1],sep="/");
input_files_folder_name <-paste(dirname(dirname(base_path)),"/Input/",sep="")
setwd(folder_name);
```

```{r,include=FALSE}
#Load main data file

number_populations <- Get_Number_of_Populations(folder_name);
# data            <- Load_data(folder_name,number_populations);
data_potential  <- Load_Potential(folder_name,number_populations);
data_rasterplot <- Load_Rasterplot(folder_name,number_populations);
data_currents   <- Load_Currents(folder_name,number_populations);
# data_synapses   <- Load_Synapses(folder_name,number_populations);
data_ConnectivityMatrix_00 <- Load_Connectivity(folder_name,0,0, TRUE);
data_SynapsesConnection_00 <- Load_Connectivity(input_files_folder_name,0,0, FALSE);
```

# Connectivity Matrices

We show two plots: newly constructed matrix used for the simulations and the pre-existing connectivity matrix used as input. The plots are binary connectivity matrix where black dots indicate connection while white dots indicate non-connection. The rows of the connectivity matrix is pre-synaptic neuron and columns are post-synaptic neuron. In this test, we only used pre-existing connectivity matrix from 0 -> 0 population connection and other connections are all randomly connected.


```{r,echo=FALSE, fig.width=12}

X<-0:(ncol(data_ConnectivityMatrix_00)-1)
Y<-0:(nrow(data_ConnectivityMatrix_00)-1)

library(RColorBrewer)

data_ConnectivityMatrix_00<-as.matrix(data_ConnectivityMatrix_00)
data_SynapsesConnection_00<-as.matrix(data_SynapsesConnection_00)

nf <- layout(matrix(c(1,2),1,2, byrow=T), widths=c(1,1,1), heights=c(1,1,1), respect=T)
par(mar=c(3,3,3,3))

coul <- colorRampPalette(brewer.pal(8, "Greys"))(25)
image(data_SynapsesConnection_00, col=coul, axes=FALSE)
title("Pre-existing connectivity matrix", line = 1)

image(data_ConnectivityMatrix_00, col=coul, axes=FALSE)
title("Constructed connectivity matrix", line = 1)



```
The below code prints a TRUE value if the two matrices are equal and prints FALSE if they are not equal.

is_equal <- all.equal(data_SynapsesConnection_00,data_ConnectivityMatrix_00);
str_to_print <- "The two matrices are equal:";

print(paste(str_to_print, is_equal));

```{r,echo=FALSE}

is_equal <- all.equal(data_SynapsesConnection_00,data_ConnectivityMatrix_00);
str_to_print <- "The two matrices are equal:";

print(paste(str_to_print, is_equal));
```
# Raster plot

In the following plots, we show the spike times of individual neurons from two populations. The external input to the two population is increased linearly from 0 to 100. 

```{r,echo=FALSE, fig.width=12}

measurednu<-filter(data_rasterplot,(data_rasterplot$Pop_id == 2) & (data_rasterplot$Spike_t)>1 )
measurednu=nrow(measurednu)*0.1

data_rasterplot %>%
  ggplot(aes(x=Spike_t,y=Neuron_id,color=factor(Pop_id)))+
  geom_point() +
    facet_wrap(~ Pop_id, scales = "free", ncol = 1) +
    theme_bw()+
    scale_y_continuous(breaks=c(seq(1,100,by=10)))+
    theme(legend.position = "none")

```